<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>烟花特效</title>
  <style>
    /* 页面基础样式 */
    body {
      margin: 0;
      padding: 0;
      overflow: hidden; 
      background: #000; 
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    /* 显示文字样式 */
    #showText {
      position: absolute;
      color: #ff4d6d;
      font-size: 36px;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      animation: fadeIn 2s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-50%) scale(0.8); }
      to { opacity: 1; transform: translateX(-50%) scale(1); }
    }
    /* 音乐控制器样式 */
    #musicControl {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(5px);
      transition: all 0.3s;
    }
    #musicControl:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    #musicIcon {
      color: white;
      font-size: 18px;
    }
    /* 加载提示样式 */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: Arial, sans-serif;
      z-index: 200;
    }
    #loading p {
      margin-top: 20px;
      font-size: 16px;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid white;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* 音乐加载失败提示 */
    #musicError {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
      z-index: 100;
      display: none;
      max-width: 200px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- 加载提示 -->
  <div id="loading">
    <div class="spinner"></div>
    <p>正在准备惊喜...</p>
  </div>
  
  <!-- 音乐元素 - 使用网易云音乐《稻香》 -->
  <audio id="bgMusic" loop>
    <source src="https://music.163.com/song/media/outer/url?id=136759.mp3" type="audio/mpeg">
  </audio>
  
  <!-- 音乐控制器 -->
  <div id="musicControl">
    <i id="musicIcon" class="fa fa-volume-up"></i>
  </div>
  
  <!-- 音乐加载失败提示 -->
  <div id="musicError">
    音乐加载失败，请点击按钮播放
  </div>
  
  <!-- 要显示的文字 -->
  <div id="showText">余生有你便足矣</div>
  
  <!-- 烟花特效核心JS（依赖Canvas） -->
  <script>
    // DOM元素
    const showText = document.getElementById('showText');
    const bgMusic = document.getElementById('bgMusic');
    const musicControl = document.getElementById('musicControl');
    const musicIcon = document.getElementById('musicIcon');
    const loading = document.getElementById('loading');
    const musicError = document.getElementById('musicError');
    let isMusicPlaying = false;
    let isMusicLoaded = false;
    
    // 音乐控制
    musicControl.addEventListener('click', toggleMusic);
    
    function toggleMusic() {
      if (isMusicPlaying) {
        bgMusic.pause();
        musicIcon.className = 'fa fa-volume-off';
      } else {
        if (!isMusicLoaded) {
          // 如果音乐还没加载，先加载
          loadMusic();
        } else {
          // 已经加载，直接播放
          bgMusic.play().catch(handlePlayError);
        }
      }
      isMusicPlaying = !isMusicPlaying;
    }
    
    // 加载音乐
    function loadMusic() {
      bgMusic.load();
      bgMusic.play().catch(handlePlayError);
      
      // 监听音乐加载状态
      bgMusic.addEventListener('loadeddata', () => {
        isMusicLoaded = true;
        console.log('音乐加载成功');
      });
      
      // 监听音乐错误
      bgMusic.addEventListener('error', handleMusicError);
    }
    
    // 处理播放错误
    function handlePlayError(error) {
      console.log('音乐播放失败:', error);
      musicIcon.className = 'fa fa-volume-up';
      isMusicPlaying = false;
      showMusicError();
    }
    
    // 处理音乐加载错误
    function handleMusicError() {
      console.log('音乐加载错误:', bgMusic.error);
      isMusicLoaded = false;
      showMusicError();
    }
    
    // 显示音乐错误提示
    function showMusicError() {
      musicError.style.display = 'block';
      // 5秒后自动隐藏
      setTimeout(() => {
        musicError.style.display = 'none';
      }, 5000);
    }
    
    // 自动启动体验
    function startExperience() {
      // 隐藏加载提示
      loading.style.opacity = '0';
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1000);
      
      // 显示目标文字
      showText.style.display = 'block';
      
      // 尝试加载并播放音乐
      setTimeout(loadMusic, 1000);
      
      // 延迟启动烟花（让文字先显示）
      setTimeout(() => startFireworks(), 3000);
    }
    
    // 烟花特效逻辑（基于Canvas）
    let canvas, ctx;
    let fireworks = [];
    let particles = [];
    const gravity = 0.2;

    // 初始化Canvas
    function initCanvas() {
      canvas = document.createElement('canvas');
      ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      document.body.appendChild(canvas);
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    }

    // 启动烟花（生成初始烟花）
    function startFireworks() {
      initCanvas();
      // 循环生成烟花，模拟连续发射
      setInterval(() => {
        createFirework(
          Math.random() * canvas.width, 
          canvas.height, 
          Math.random() * canvas.width, 
          Math.random() * canvas.height * 0.5
        );
      }, 1000); 
      animate();
    }

    // 创建单个烟花（从底部飞到上方爆炸）
    function createFirework(x, y, targetX, targetY) {
      fireworks.push({
        x, y, targetX, targetY,
        speed: 5 + Math.random() * 3, 
        hue: Math.random() * 360, 
        trail: [],
        trailLength: 10,
        alpha: 1
      });
    }

    // 动画循环（更新+绘制烟花/粒子）
    function animate() {
      requestAnimationFrame(animate);
      // 半透明背景，保留拖影
      ctx.fillStyle = 'rgba(0,0,0,0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // 更新烟花
      for (let i = fireworks.length - 1; i >= 0; i--) {
        const firework = fireworks[i];
        // 记录轨迹
        firework.trail.push({ x: firework.x, y: firework.y });
        if (firework.trail.length > firework.trailLength) {
          firework.trail.shift();
        }

        // 计算距离，判断是否爆炸
        const dx = firework.targetX - firework.x;
        const dy = firework.targetY - firework.y;
        const dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < 5) { 
          // 爆炸生成粒子
          explode(firework.x, firework.y, firework.hue);
          fireworks.splice(i, 1);
        } else {
          // 没到目标，继续移动
          const angle = Math.atan2(dy, dx);
          firework.x += Math.cos(angle) * firework.speed;
          firework.y += Math.sin(angle) * firework.speed;
          // 绘制轨迹
          drawTrail(firework);
        }
      }

      // 更新粒子
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += gravity; 
        p.life -= 0.01;  

        if (p.life <= 0) {
          particles.splice(i, 1);
          continue;
        }
        // 绘制粒子
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fillStyle = `hsla(${p.hue}, 100%, 50%, ${p.life})`;
        ctx.fill();
      }
    }

    // 爆炸生成粒子
    function explode(x, y, hue) {
      for (let i = 0; i < 200; i++) { 
        const angle = Math.random() * Math.PI*2;
        const speed = 3 + Math.random() * 5;
        particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          size: 1 + Math.random() * 3, 
          hue,
          life: 1
        });
      }
    }

    // 绘制烟花轨迹
    function drawTrail(firework) {
      for (let j = 0; j < firework.trail.length; j++) {
        const point = firework.trail[j];
        const size = 3 * (1 - j / firework.trailLength);
        const alpha = firework.alpha * (1 - j / firework.trailLength);
        ctx.beginPath();
        ctx.arc(point.x, point.y, size, 0, Math.PI*2);
        ctx.fillStyle = `hsla(${firework.hue}, 100%, 50%, ${alpha})`;
        ctx.fill();
      }
    }
    
    // 页面加载完成后自动启动
    window.addEventListener('load', startExperience);
  </script>
</body>
</html>
